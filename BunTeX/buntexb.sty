\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{buntexb}[2022/04/17]

% トンボの設定
% https://github.com/abenori/jlreq/blob/master/jlreq-trimmarks-ja.md を参照のこと
\usepackage[show={trimmarks,digital}, bleed_margin={top=3truemm,bottom=3truemm,gutter=3truemm,fore-edge=3truemm}, lualatex]{jlreq-trimmarks}
\setlength{\topskip}{5truemm}

%PageStyle
\NewPageStyle{normal}{
    yoko,
    running_head_position=top-right,
    nombre_position=top-right,
    nombre=,
    odd_running_head=\headerodd,
    even_running_head=\headereven,
}

%%%% テキストをTikzで置き換え

\newcommand{\headerodd}{%
    \vbox to 17truemm{\vskip-15.53truemm
        \hbox to 127truemm{
            \hfill
            {\raise2truemm\hbox{{\fontsize{10truept}{10truept}\selectfont\textgt{第１回\hspace{1\zw}原子とイオン}}}
            \hspace{5truemm}
            \begin{tikzpicture}
                \fill[black] (0,0) rectangle (3mm,20mm);
            \end{tikzpicture}}
            \hspace{0truemm}
            \raise2truemm\hbox{{\fontsize{12truept}{12truept}\selectfont\GenEiNombre{\textit{105}}}}
            \hspace{-12.61truemm}
        }\vss}
}

\newcommand{\headereven}{%
    \vbox to 17truemm{\vskip-15.53truemm
        \hbox to 127truemm{\hskip-16.08truemm
            \hbox to 11.5truemm{\hfill\raise2truemm\hbox{{\fontsize{12truept}{12truept}\selectfont\GenEiNombre{\textit{105}}}}}
            \hspace{0.46truemm}
            \begin{tikzpicture}
                \fill[black] (0,0) rectangle (3mm,20mm);
            \end{tikzpicture}
            \hspace{5truemm}
            {\raise2truemm\hbox{{\fontsize{10truept}{10truept}\selectfont\textgt{第１回\hspace{1\zw}原子とイオン}}}
            }
        \hss}\vss}
}


%✅2. セクション%  ❌p96,109 chapter, ✅section, ✅subsection, ✅p63 二重▷,  ❌p103 修正, ✅p72　▶︎　環境依存文字を使用, ✅p45-46 キーポイント
\renewcommand{\thesection}{\arabic{section}}
\renewcommand{\thesubsection}{\arabic{section}.\arabic{subsection}}
\ModifyHeading{section}{%
format={%
\vspace{10truemm}
\vbox to 13.5truemm{\vskip-0truemm
    \hbox to 144truemm{\hskip-3truemm
    \begin{tikzpicture}
        \fill[black!70] (6.5mm,4.75mm) ellipse (6.5mm and 4.75mm);
        \draw[white] (6.5mm,4.75mm) node {\hbox{\fontsize{10pt}{10pt}\selectfont\HiraKakusixE \S {\fontsize{12pt}{12pt}\selectfont \thesection}}};
        \draw[text=black!90] node (A) at (22mm,4.75mm) [anchor=west] {\hbox{\fontsize{12pt}{12pt}\selectfont\HiraKakusix #2}};
        \draw[line width=1pt, black!70] (19mm,8.75mm) -- (140mm,8.75mm);
        \draw[line width=1pt, black!70] (13mm,0.75mm) -- (140mm,0.75mm);
        \fill[black!90] (13mm,0.75mm) circle (0.5mm);
        \fill[black!90] (19mm,8.75mm) circle (0.5mm);
        \draw[line width=1pt, black!70] (140mm,0.75mm) arc (-90:90:4mm);
    \end{tikzpicture}
    \hss}\vss}
    \vskip-10truemm
}
}

\newcommand{\nosubsection}{\vspace{7.7truemm}}

\ModifyHeading{subsection}{%
format={%
\vspace{10truemm}
\vbox to 6.6truemm{\vskip-0truemm
    \hbox to 142truemm{\hskip-0truemm
        \begin{tikzpicture}
            \fill[black!90, rounded corners=1mm] (0mm,0mm) [anchor=north west] rectangle (9mm,6mm);
            \draw[white] (4.5mm,3mm) node {\hbox{\fontsize{10pt}{10pt}\selectfont\HiraKakusixE \thesubsection}};
            \draw[line width=1pt, black!90] (9mm,3mm) -- (14mm,3mm);
            \fill[black!90] (141.25mm,3mm) circle (0.75mm);
            \draw[text=black!90] node (A) at (14mm,3mm) [anchor=west] {\hbox{\fontsize{10pt}{10pt}\selectfont\HiraKakusix #2}};
            \draw[line width=1pt, black!90] (A.east) --  (141.25mm,3mm);
        \end{tikzpicture}
    \hss}\vss}
}
}

\newcommand{\keypoint}[1]{\hbox to 142truemm{\hskip-0truemm
\noindent ▶︎ \uline[background, color=black!30, width=1mm, position=0pt]{\gothic{こんにちは}}
\hss}}
\newcommand{\subkeypoint}[1]{\hbox to 142truemm{\hskip-0truemm
\noindent \(\triangleright\triangleright\)~\gothic{#1}
\hss}}





%✅3. 枠囲み%  ✅key・❌指針・✅例題・✅補足・✅参考・✅注意・❌p68問題例
% 参考
\newenvironment{framebox-ref}[1]{\begin{ascolorbox5}[#1]{参~考}}{\end{ascolorbox5}}
\newenvironment{framebox-note}[1]{\begin{ascolorbox19}[#1]{補足}}{\end{ascolorbox19}}
\newenvironment{framebox-simple}[1]{\begin{simplesquarebox}{#1}}{\end{simplesquarebox}}
\newenvironment{framebox-key}[1]{\begin{simplesquarebox}{KEY}}{\end{simplesquarebox}}
\newenvironment{framebox-simplen}[2]{\begin{simplesquarebox}[#2]{#1}}{\end{simplesquarebox}}
\newenvironment{framebox-ex}[2]{\begin{ascolorbox4}[#2]{#1}}{\end{ascolorbox4}}
\newenvironment{framebox-warning}[1]{\begin{ascolorbox13}[#1]{注意}}{\end{ascolorbox13}}



%✅4. 画像挿入% 図入れ　❎p4ミニページ, ✅p5全体, ❎p13, ✅p32二つ並べ, ✅p414255 wrapfig, p61キャプションなし画像, ❎p91
\newcommand{\singleimage}[3]{%
\begin{figure}[H]
    \centering
    \includegraphics[keepaspectratio, width=#1]{#2}
    \gothic{\caption{#3}}
\end{figure}}

\newcommand{\doubleimage}[4]{%
    \begin{figure}[H]
        \begin{minipage}[b]{0.45\linewidth}
          \centering
          \includegraphics[keepaspectratio, width=\columnwidth]{#1}
          \gothic{\caption{#2}}
        \end{minipage}
        \hspace{0.1\columnwidth}
        \begin{minipage}[b]{0.45\linewidth}
          \centering
          \includegraphics[keepaspectratio, width=\columnwidth]{#3}
          \gothic{\caption{#4}}
        \end{minipage}
      \end{figure}
}

%#1と#2の差は6mm
\newcommand{\wrapfig}[3]{%
    \begin{wrapfigure}{r}[0pt]{\advance#1 by 6truemm}
        \centering
          \includegraphics[width=#1]{#2}
        \gothic{caption{#3}}
       \end{wrapfigure}
}

\newcommand{\singleimagenocap}[2]{%
\begin{figure}[H]
    \centering
    \includegraphics[keepaspectratio, width=#1]{#2}
\end{figure}
}




%5. 表% p5, p38, p86
\usepackage{colortbl}
\newcolumntype{I}{!{\vrule width 1pt}}


%✅6. リスト%  ✅p19リスト ・, ✅(1), ✅p29,76①, ✅p31四角1, ✅p39・→Quoteとの合わせ一本, ❎p135 サブ(a), ❌p21 description?
%\jlreqsetup{
    %quote_indent=<寸法>,
    %quote_end_indent=<寸法>,
    %quote_beforeafter_space=<寸法>,
    %itemization_beforeafter_space=<寸法>,
    %itemization_itemsep=<寸法>
%}
\renewcommand{\labelitemi}{・~}
\newenvironment{enumerate-brackets}{\begin{enumerate} \renewcommand{\labelenumi}{\ajKakko{\arabic{enumi}}~}}{\end{enumerate}}
\newenvironment{enumerate-circle}{\begin{enumerate} \renewcommand{\labelenumi}{\ajMaru{\arabic{enumi}}~}}{\end{enumerate}}
\newenvironment{enumerate-square}{\begin{enumerate} \renewcommand{\labelenumi}{\ajKaku{\arabic{enumi}}~}}{\end{enumerate}}


%8. 空欄% p53 四角空欄


%9. 索引% ✅索引
\usepackage{makeidx}
\makeindex


%✅10. その他% ✅p62 3mmまでならギリギリ配置→美文書


%11. 表紙系統%　カリキュラム表, ✅表1,✅3,✅4, p2p3授業概要, 背表紙
\newcommand{\covera}[5]{
    \vbox to 151truemm{\vskip-6.71truemm
        \hbox to 227truemm{\hskip-10.52truemm
        \begin{tikzpicture}
            \draw[line width=0.4pt] (0,0) rectangle (150mm,-226mm);
            \fill[black] (150mm,-1mm) rectangle (151mm,-227mm);
            \fill[black] (1mm,-226mm) rectangle (151mm,-227mm);
            \draw[text=black] node (A) at (0mm,-21mm) [anchor=north west] {\hbox{\textgt{\fontsize{15truept}{15truept}\selectfont\hspace{5truemm}#1}}};
            \draw[text=black] node (B) at (0mm,-33mm) [anchor=north west] {\hbox{\hspace{5truemm}\textgt{\bfseries\fontsize{20truept}{20truept}\selectfont #2}\hspace{5truemm}}};
            \draw[line width=1mm, black] (0mm,-30mm) -- ($(B.north east) + (0mm,3mm)$);
            \draw[text=black] node (C) at (130mm,-211mm) [anchor=south east] {\hbox{\textgt{\fontsize{12truept}{12truept}\selectfont {\bfseries #3}#4}}};
            \draw[text=black] node (D) at (151mm,-233mm) [anchor=south east] {\hbox{\textsf{\fontsize{12truept}{12truept}\selectfont #5}}};
        \end{tikzpicture}
        \hss}\vss}
    \newpage
}

% 二段組（授業概要時）
\setlength{\columnseprule}{.4truept}
\setlength{\columnsep}{6truemm}
\newcommand{\aboutsection}[1]{\noindent\gothic{【#1】}\\}
\newcommand{\aboutsubsection}[1]{\noindent\gothic{#1}\\}

\endinput