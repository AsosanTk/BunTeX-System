\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{buntexb}[2022/06/26]
% トンボの設定
% https://github.com/abenori/jlreq/blob/master/jlreq-trimmarks-ja.md を参照のこと
\usepackage[show={trimmarks,digital}, bleed_margin={top=3mm,bottom=3mm,gutter=3mm,fore-edge=3mm}, lualatex]{jlreq-trimmarks}
\setlength{\topskip}{5mm}
\setmainfont[
    OpticalSize = 0,
    SmallCapsFont = lmromancaps10-regular,
    SlantedFont = lmromanslant10-regular,
    FontFace = {sb}{n}{lmromandemi10-regular}
]{Latin Modern Roman}

%✅3. 枠囲み%  ✅key・❌指針・✅例題・✅補足・✅参考・✅注意・❌p68問題例
% 参考
\newenvironment{framebox-ref}[1]{\begin{ascolorbox5}[\gothic{#1}]{参~考}}{\end{ascolorbox5}}
\newenvironment{framebox-note}[1]{\begin{ascolorbox19}[\gothic{#1}]{補足}}{\end{ascolorbox19}}
\newenvironment{framebox-simple}[1]{\begin{simplesquarebox}{\gothic{#1}}}{\end{simplesquarebox}}
\newenvironment{framebox-key}{\begin{simplesquarebox}{\gothic{KEY}}}{\end{simplesquarebox}}
\newenvironment{framebox-simples}[2]{\begin{simplesquarebox}[\gothic{#2}]{\gothic{#1}}}{\end{simplesquarebox}}
\newenvironment{framebox-ex}[2]{\begin{ascolorbox4}[\gothic{#2}]{\gothic{#1}}}{\end{ascolorbox4}}
\newenvironment{framebox-warning}[1]{\begin{ascolorbox13}[\gothic{#1}]{\gothic{注意}}}{\end{ascolorbox13}}
\newenvironment{framebox-practice}[1]{\begin{practicebox}{\gothic{#1}}}{\end{practicebox}}
\newenvironment{framebox-guideline}{\begin{ascolorbox16}{\gothic{指針}}}{\end{ascolorbox16}}

\renewcommand{\labelitemi}{・~}
\newenvironment{enumbrackets}{\begin{enumerate}\renewcommand{\labelenumi}{\ajKakko{\arabic{enumi}}~}}{\end{enumerate}}
\newenvironment{enumcircle}{\begin{enumerate}\renewcommand{\labelenumi}{\ajMaru{\arabic{enumi}}~}}{\end{enumerate}}
\newenvironment{enumsquare}{\begin{enumerate}\renewcommand{\labelenumi}{\ajKaku{\arabic{enumi}}~}}{\end{enumerate}}
\newenvironment{enumalphii}{\begin{enumerate}\renewcommand{\labelenumii}{\ajKakkoalph{\arabic{enumii}}~}}{\end{enumerate}}




\newcommand{\blanknumbox}[1]{~\(\boxed{\phantom{aa}\gothic{#1}\phantom{aa}}\)~}





%5. 表% p5, p38, p86
\usepackage{colortbl}
\newcolumntype{I}{!{\vrule width 1pt}}


%✅6. リスト%  ✅p19リスト ・, ✅(1), ✅p29,76①, ✅p31四角1, ✅p39・→Quoteとの合わせ一本, ❎p135 サブ(a), ❌p21 description?
%\jlreqsetup{
    %quote_indent=<寸法>,
    %quote_end_indent=<寸法>,
    %quote_beforeafter_space=<寸法>,
    %itemization_beforeafter_space=<寸法>,
    %itemization_itemsep=<寸法>
%}

%8. 空欄% p53 四角空欄


%9. 索引% ✅索引



%✅10. その他% ✅p62 3mmまでならギリギリ配置→美文書



\usepackage{makeidx}
\makeindex







%------------未検閲-------------

%PageStyle
\NewPageStyle{normal}{
    yoko,
    running_head_position=top-right,
    nombre_position=top-right,
    nombre=,
    odd_running_head=\headerodd,
    even_running_head=\headereven,
}

%%%% テキストをTikzで置き換え

\newcommand{\headerodd}{%
    \vbox to 17mm{\vskip-15.53mm
        \hbox to 127mm{
            \hfill
            {\raise2mm\hbox{{\selectsize{10pt}{10pt}\gothic{第~{\thechapter}~回\hspace{1\zw}_chapter}}}}
            \hspace{5mm}
            \begin{tikzpicture}
                \fill[black] (0,0) rectangle (3mm,20mm);
            \end{tikzpicture}}
            \hspace{0mm}
            \raise2mm\hbox{{\selectsize{12pt}{12pt}\GenEiNombre{\textit{\thepage}}}}
            \hspace{-12.61mm}
        }\vss}
}

\newcommand{\headereven}{%
    \vbox to 17mm{\vskip-15.53mm
        \hbox to 127mm{\hskip-16.08mm
            \hbox to 11.5mm{\hfill\raise2mm\hbox{{\selectsize{12pt}{12pt}\GenEiNombre{\textit{\thepage}}}}}
            \hspace{0.46mm}
            \begin{tikzpicture}
                \fill[black] (0,0) rectangle (3mm,20mm);
            \end{tikzpicture}
            \hspace{5mm}
            {\raise2mm\hbox{{\fontsize{10pt}{10pt}\selectfont\gothic{第~{\thechapter}~回\hspace{1\zw}_chapter}}}}
        \hss}\vss}
}


%✅2. セクション%  ❌p96,109 chapter, ✅section, ✅subsection, ✅p63 二重▷,  ❌p103 修正, ✅p72　▶︎　環境依存文字を使用, ✅p45-46 キーポイント
\renewcommand{\thesection}{\arabic{section}}
\renewcommand{\thesubsection}{\arabic{section}.\arabic{subsection}}
\ModifyHeading{section}{%
format={%
\vbox to 13.5mm{\vskip-0mm
    \hbox to 144mm{\hskip-3mm
    \begin{tikzpicture}
        \fill[black!70] (6.5mm,4.75mm) ellipse (6.5mm and 4.75mm);
        \draw[white] (6.5mm,4.75mm) node {\hbox{\fontsize{10pt}{10pt}\selectfont\HiraKakusixE \S {\fontsize{12pt}{12pt}\selectfont \thesection}}};
        \draw[text=black!90] node (A) at (22mm,4.75mm) [anchor=west] {\hbox{\fontsize{12pt}{12pt}\selectfont\HiraKakusix #2}};
        \draw[line width=1pt, black!70] (19mm,8.75mm) -- (140mm,8.75mm);
        \draw[line width=1pt, black!70] (13mm,0.75mm) -- (140mm,0.75mm);
        \fill[black!90] (13mm,0.75mm) circle (0.5mm);
        \fill[black!90] (19mm,8.75mm) circle (0.5mm);
        \draw[line width=1pt, black!70] (140mm,0.75mm) arc (-90:90:4mm);
    \end{tikzpicture}
    \hss}\vss}
}
}


\ModifyHeading{subsection}{%
format={%
\vbox to 6.6mm{\vskip-0mm
    \hbox to 142mm{\hskip-0mm
        \begin{tikzpicture}
            \fill[black!90, rounded corners=1mm] (0mm,0mm) [anchor=north west] rectangle (9mm,6mm);
            \draw[white] (4.5mm,3mm) node {\hbox{\fontsize{10pt}{10pt}\selectfont\HiraKakusixE\thesubsection}};
            \draw[line width=1pt, black!90] (9mm,3mm) -- (14mm,3mm);
            \fill[black!90] (141.25mm,3mm) circle (0.75mm);
            \draw[text=black!90] node (A) at (14mm,3mm) [anchor=west] {\hbox{\fontsize{10pt}{10pt}\selectfont\HiraKakusix #2}};
            \draw[line width=1pt, black!90] (A.east) --  (141.25mm,3mm);
        \end{tikzpicture}
    \hss}\vss}
}
}

\NewBlockHeading{keypoint}{3}{%
format={%
\hbox to 142mm{\hskip-0mm
\noindent ▶︎ \uline[background, color=black!30, width=1mm, position=0pt]{\gothic{#2}}
\hss}
}
}

\NewBlockHeading{subkeypoint}{4}{%
format={%
\hbox to 142mm{\hskip-0mm
\noindent \(\triangleright\triangleright\)~\gothic{#1}
\hss}
}
}







%✅4. 画像挿入% 図入れ　❎p4ミニページ, ✅p5全体, ❎p13, ✅p32二つ並べ, ✅p414255 wrapfig, p61キャプションなし画像, ❎p91
\newcommand{\singleimage}[3]{%
\begin{figure}[H]
    \centering
    \includegraphics[keepaspectratio, width=#1]{#2}
    \gothic{\caption{#3}}
\end{figure}}

\newcommand{\doubleimage}[4]{%
    \begin{figure}[H]
        \begin{minipage}[b]{0.45\linewidth}
          \centering
          \includegraphics[keepaspectratio, width=\columnwidth]{#1}
          \gothic{\caption{#2}}
        \end{minipage}
        \hspace{0.1\columnwidth}
        \begin{minipage}[b]{0.45\linewidth}
          \centering
          \includegraphics[keepaspectratio, width=\columnwidth]{#3}
          \gothic{\caption{#4}}
        \end{minipage}
      \end{figure}
}

%#1と#2の差は6mm
\newcommand{\wrapfig}[3]{%
    \begin{wrapfigure}{r}[0pt]{\advance#1 by 6mm}
        \centering
          \includegraphics[width=#1]{#2}
        \gothic{caption{#3}}
       \end{wrapfigure}
}

\newcommand{\singleimagenocap}[2]{%
\begin{figure}[H]
    \centering
    \includegraphics[keepaspectratio, width=#1]{#2}
\end{figure}
}







%11. 表紙系統%　カリキュラム表, ✅表1,✅3,✅4, p2p3授業概要, 背表紙
\newcommand{\covera}[5]{
    \vbox to 151mm{\vskip-6.71mm
        \hbox to 227mm{\hskip-10.52mm
        \begin{tikzpicture}
            \draw[line width=0.4pt] (0,0) rectangle (150mm,-226mm);
            \fill[black] (150mm,-1mm) rectangle (151mm,-227mm);
            \fill[black] (1mm,-226mm) rectangle (151mm,-227mm);
            \draw[text=black] node (A) at (0mm,-21mm) [anchor=north west] {\hbox{\gothic{\selectsize{15pt}{15pt}\hspace{5mm}#1}}};
            \draw[text=black] node (B) at (0mm,-33mm) [anchor=north west] {\hbox{\hspace{5mm}\gothic{\bfseries\selectsize{20pt}{20pt}#2}\hspace{5mm}}};
            \draw[line width=1mm, black] (0mm,-30mm) -- ($(B.north east) + (0mm,3mm)$);
            \draw[text=black] node (C) at (130mm,-211mm) [anchor=south east] {\hbox{\gothic{\selectsize{12pt}{12pt}{\HiraKakusixE{#3}}#4}}};
            \draw[text=black] node (D) at (153mm,-233mm) [anchor=south east] {\hbox{\textsf{\selectsize{12pt}{12pt}#5}}};
        \end{tikzpicture}
        \hss}\vss}
    \newpage
}

% 二段組（授業概要時）
\setlength{\columnseprule}{.4pt}
\setlength{\columnsep}{6mm}
\newcommand{\aboutsection}[1]{\noindent\gothic{【#1】}\\}
\newcommand{\aboutsubsection}[1]{\noindent\gothic{#1}\\}









\endinput